<script lang="ts">
  import type { ServiceType } from '../../types';
  import { connectionsState } from '../../stores/connections.svelte';
  import * as Tooltip from '$lib/components/ui/tooltip/index.js';

  let { service }: { service: ServiceType } = $props();

  const labels: Record<ServiceType, string> = {
    moco: 'Moco',
    jira: 'Jira',
    outlook: 'Outlook'
  };

  // Map services to dedicated source text colors
  const serviceColors: Record<ServiceType, string> = {
    moco: 'text-source-moco-text',
    jira: 'text-source-jira-text',
    outlook: 'text-source-outlook-text'
  };

  let isConnected = $derived(connectionsState[service].isConnected);
  let colorClass = $derived(isConnected ? serviceColors[service] : 'text-muted-foreground');
</script>

<Tooltip.Provider delayDuration={200}>
  <Tooltip.Root>
    <Tooltip.Trigger>
      <div
        class="flex items-center justify-center size-6 transition-all duration-200
          {colorClass} {isConnected ? '' : 'grayscale'}"
      >
        {#if service === 'moco'}
          <!-- Moco Logo -->
          <svg
            class="size-4"
            viewBox="0 0 76 76"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g transform="matrix(1.013333,0,0,1.013333,-83.093333,0)">
              <g transform="matrix(0.986842,0,0,0.986842,-0.5,-0.098684)">
                <path
                  d="M121.6,26.1C118.5,26.1 115.7,27 113.2,28.5C116.3,29.2 118.6,32 118.6,35.3C118.6,39.2 115.5,42.3 111.6,42.3C109.3,42.3 107.3,41.2 106.1,39.6C106,40.3 105.9,41.1 105.9,41.8C105.9,50.5 112.9,57.5 121.6,57.5C130.3,57.5 137.3,50.5 137.3,41.8C137.3,33.1 130.3,26.1 121.6,26.1Z"
                />
              </g>
              <g transform="matrix(0.986842,0,0,0.986842,-0.5,-0.098684)">
                <path
                  d="M121.6,75.7C116.4,75.7 111.5,74.7 107,72.7C102.5,70.7 98.5,68 95.1,64.6C91.7,61.2 89,57.2 87,52.7C85,48.2 84,43.2 84,38.1C84,32.9 85,28 87,23.5C89,19 91.7,15 95.1,11.6C98.5,8.2 102.5,5.5 107,3.5C111.5,1.5 116.5,0.5 121.6,0.5C126.8,0.5 131.7,1.5 136.2,3.5C140.7,5.5 144.7,8.2 148.1,11.6C151.5,15 154.2,19 156.2,23.5C158.2,28 159.2,33 159.2,38.1C159.2,43.3 158.2,48.2 156.2,52.7C154.2,57.2 151.5,61.2 148.1,64.6C144.7,68 140.7,70.7 136.2,72.7C131.7,74.7 126.8,75.7 121.6,75.7ZM121.6,11.1C117.9,11.1 114.3,11.8 111.1,13.2C107.8,14.6 104.9,16.6 102.5,19C100.1,21.4 98.1,24.3 96.7,27.6C95.3,30.9 94.6,34.4 94.6,38.1C94.6,41.8 95.3,45.4 96.7,48.6C98.1,51.9 100.1,54.8 102.5,57.2C104.9,59.6 107.8,61.6 111.1,63C114.4,64.4 117.9,65.1 121.6,65.1C125.3,65.1 128.8,64.4 132.1,63C135.4,61.6 138.3,59.7 140.7,57.2C143.1,54.8 145.1,51.9 146.5,48.6C147.9,45.3 148.6,41.8 148.6,38.1C148.6,34.4 147.9,30.9 146.5,27.6C145.1,24.3 143.1,21.4 140.7,19C138.3,16.6 135.4,14.7 132.1,13.2C128.8,11.8 125.3,11.1 121.6,11.1Z"
                  fill-rule="nonzero"
                />
              </g>
            </g>
          </svg>
        {:else if service === 'jira'}
          <!-- Jira Logo -->
          <svg
            class="size-4"
            viewBox="0 0 24 24"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M11.571 11.513H0a5.218 5.218 0 0 0 5.232 5.215h2.13v2.057A5.215 5.215 0 0 0 12.575 24V12.518a1.005 1.005 0 0 0-1.005-1.005zm5.723-5.756H5.736a5.215 5.215 0 0 0 5.215 5.214h2.129v2.058a5.218 5.218 0 0 0 5.215 5.214V6.758a1.001 1.001 0 0 0-1.001-1.001zM23.013 0H11.455a5.215 5.215 0 0 0 5.215 5.215h2.129v2.057A5.215 5.215 0 0 0 24 12.483V1.005A1.001 1.001 0 0 0 23.013 0Z"
            />
          </svg>
        {:else if service === 'outlook'}
          <!-- Outlook Logo -->
          <svg
            class="size-4"
            viewBox="0 0 50 50"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M 25.505859 4.0253906 C 24.180859 4.0266406 22.854219 4.4051563 21.699219 5.1601562 L 6.5 15.019531 C 5.57 15.619531 5 16.659531 5 17.769531 L 5 18.810547 C 5 18.870547 4.9997656 18.94 5.0097656 19 L 13.849609 19 L 29.230469 9.2304688 C 29.920469 8.7904688 30.329141 8.0697656 30.369141 7.2597656 C 30.399141 6.4597656 30.059687 5.7204688 29.429688 5.2304688 L 29.410156 5.2109375 L 29.310547 5.1503906 C 28.155547 4.4003906 26.830859 4.0241406 25.505859 4.0253906 z M 32.359375 7.1308594 L 32.359375 7.3496094 C 32.299375 8.8196094 31.550781 10.120156 30.300781 10.910156 L 17.160156 19.259766 C 19.360156 19.949766 20.98 22.019219 21 24.449219 L 37.140625 14.220703 C 37.850625 13.770703 38.25 13.039219 38.25 12.199219 C 38.25 11.499219 37.959219 10.869687 37.449219 10.429688 L 32.359375 7.1308594 z M 40.25 12.25 C 40.23 13.74 39.480938 15.110156 38.210938 15.910156 L 21 26.820312 L 21 30.210938 L 24.669922 32.519531 L 44.880859 19.839844 C 45.580859 19.399844 46 18.650078 46 17.830078 L 46 17.769531 C 46 16.649531 45.44 15.609766 44.5 15.009766 L 40.25 12.25 z M 4.5 21 C 2.567 21 1 22.567 1 24.5 L 1 35.5 C 1 37.433 2.567 39 4.5 39 L 15.5 39 C 17.433 39 19 37.433 19 35.5 L 19 24.5 C 19 22.567 17.433 21 15.5 21 L 4.5 21 z M 46 21.5 C 45.98 21.51 45.969219 21.519297 45.949219 21.529297 L 26.550781 33.710938 L 30.980469 36.5 C 32.640469 37.55 33.630859 39.350547 33.630859 41.310547 C 33.630859 42.720547 33.119531 44.01 32.269531 45 L 40 45 C 43.31 45 46 42.31 46 39 L 46 21.5 z M 10.115234 24.798828 C 11.561234 24.798828 12.738484 25.270937 13.646484 26.210938 C 14.558484 27.151937 15.013672 28.390687 15.013672 29.929688 C 15.013672 31.510687 14.542656 32.785906 13.597656 33.753906 C 12.657656 34.717906 11.443078 35.199219 9.9550781 35.199219 C 8.5040781 35.199219 7.3128125 34.732875 6.3828125 33.796875 C 5.4518125 32.860875 4.9863281 31.638813 4.9863281 30.132812 C 4.9863281 28.541813 5.4592969 27.255437 6.4042969 26.273438 C 7.3492969 25.290437 8.5852344 24.798828 10.115234 24.798828 z M 10.052734 26.779297 C 9.2477344 26.779297 8.600375 27.075922 8.109375 27.669922 C 7.618375 28.258922 7.3710937 29.040672 7.3710938 30.013672 C 7.3710937 31.000672 7.618375 31.782422 8.109375 32.357422 C 8.600375 32.928422 9.2290937 33.214844 9.9960938 33.214844 C 10.787094 33.214844 11.42425 32.934906 11.90625 32.378906 C 12.38825 31.821906 12.628906 31.048641 12.628906 30.056641 C 12.628906 29.022641 12.395734 28.218578 11.927734 27.642578 C 11.459734 27.067578 10.834734 26.779297 10.052734 26.779297 z M 21 32.570312 L 21 35.5 C 21 38.53 18.53 41 15.5 41 L 5.3808594 41 C 6.2408594 43.34 8.4891406 45 11.119141 45 L 27.949219 45 C 28.919219 45 29.800937 44.62 30.460938 44 C 31.180938 43.33 31.630859 42.370547 31.630859 41.310547 C 31.630859 40.040547 30.990156 38.869453 29.910156 38.189453 L 24.669922 34.890625 L 22.140625 33.289062 L 21 32.570312 z"
            />
          </svg>
        {/if}
      </div>
    </Tooltip.Trigger>
    <Tooltip.Content side="bottom" sideOffset={4}>
      <div class="flex items-center gap-1.5">
        <span class="font-medium">{labels[service]}</span>
        <span class="text-muted-foreground">Â·</span>
        <span class={isConnected ? 'text-success-text' : 'text-muted-foreground'}>
          {isConnected ? 'Connected' : 'Not connected'}
        </span>
      </div>
    </Tooltip.Content>
  </Tooltip.Root>
</Tooltip.Provider>
